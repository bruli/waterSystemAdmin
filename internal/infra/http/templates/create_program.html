{% extends "layouts/base.html" %}
{% block content %}
<div class="container">
    <h2 class="text-center my-4">Create New {{type}} program</h2>
    {% include "partials/success_form.html" %}
    {% include "partials/error_form.html" %}

    <form action="/programs/new?type={{type}}" method="POST" class="p-4 border rounded shadow-sm mx-auto" style="max-width: 600px;">
        <div class="mb-3">
            <label for="hour" class="form-label">Hour</label>
            <input type="time" class="form-control" id="hour" name="hour" required>
        </div>

        <div id="executions-container">
            <!-- Grup inicial -->
            <div class="execution-group border rounded p-3 mb-3 position-relative">
                <div class="mb-3">
                    <label class="form-label">Seconds</label>
                    <input type="number" class="form-control" name="seconds[]" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Zones</label>
                    <div class="row">
                        {% for zone in zones %}
                        <div class="col-6 col-sm-4 col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="zones_0[]" value="{{ zone.ID }}">
                                <label class="form-check-label">{{ zone.Name }}</label>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <button type="button" class="btn btn-sm btn-outline-danger position-absolute top-0 end-0 m-2 btn-remove-exec" onclick="removeExecutionGroup(this)">üóëÔ∏è</button>
            </div>
        </div>

        <div class="mb-3 text-end">
            <button type="button" class="btn btn-outline-secondary" onclick="addExecutionGroup()">‚ûï Add Execution</button>
        </div>

        <div class="d-grid">
            <button type="submit" class="btn btn-primary" {% if error_msg %} disabled {% endif %}>Create Program</button>
        </div>
    </form>
</div>


<script>
    let groupIndex = 1;

    function addExecutionGroup() {
        const container = document.getElementById('executions-container');
        const original = container.querySelector('.execution-group');
        const clone = original.cloneNode(true);

        // Netegem els valors del grup clonat
        clone.querySelector('input[name="seconds[]"]').value = '';

        const checkboxes = clone.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach((cb, i) => {
            cb.checked = false;
            cb.name = `zones_${groupIndex}[]`;
        });

        container.appendChild(clone);
        groupIndex++;
    }

    function removeExecutionGroup(button) {
        const container = document.getElementById('executions-container');
        const group = button.closest('.execution-group');
        if (container.children.length > 1) {
            container.removeChild(group);
        }
    }
</script>

{% endblock %}